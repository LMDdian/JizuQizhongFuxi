# 计算机组成原理

要求先修课程 程序设计语言 计算机导论 计算机电路基础

本课程讨论单机系统范围内计算机各部件和系统的组成以及内部工作机制。

## 第一章 概论

### 1.1 电子计算机与存储程序控制

电子计算机全称为电子数字计算机。非电子计算机有光计算机、量子计算机、超导计算机；非数字计算机有模拟计算机。

第一台电子数字计算机是1946年2月问世的ENIAC，一直使用到1955年。

存储程序有冯·诺依曼等人于1945年6月提出。

其主要概念为

1. 计算机（指硬件）应有**运算器**、**存储器**、**控制器**、**输入设备**和**输出设备**五大基本部件组成；
2. 计算机内部采用**二进制**来表示指令和数据；
3. 将编好的程序和原始数据事先存入存储器中，然后再启动计算机工作。

以上就是存储程序的基本含义。

事实上第一台存储程序计算机EDSAC于1949年诞生，冯诺依曼设计的存储程序计算机EDVAC于1951年诞生。

目前绝大多数计算机仍建立在存储程序概念的基础上，称为**冯·诺伊曼型计算机**。

也出现了一些突破冯·诺伊曼机构的计算机，统称**为非冯结构计算机**，如：数据驱动的数据流计算机、需求驱动的规约计算机和模式匹配驱动的智能计算机等。

### 1.2 计算机的硬件组成

主机由**中央处理器**（CPU）和**主存储器**组成，中央处理器由运算器和控制器组成，除去主机以外的硬件装置（如输入设备、输出设备、辅助存储器）等称为外部设备。

#### 计算机的主要部件

##### 输入设备

输入设备的任务是把人们编好的程序和原始数据送到计算机中去，并且将他们转换成计算机内部所能识别和接受的信息方式，常用的由键盘、鼠标、扫描仪等。

##### 输出设备

输出设备的任务是将计算机的处理结果以人或其他设备所能接受的形式送出计算机。常用的由显示器、打印机、绘图仪等。

##### 存储器

存储器是用来存放程序和数据的部件，它是一个记忆装置，也是计算机能够实现“存储程序控制”的基础。

###### 主存储器

可由CPU直接访问，用来存放当前正在执行的程序和数据。

###### 辅助存储器

设置在主机外部，CPU不能直接访问，用来存放暂时不参与运行的程序和数据，需要时再传送到主存。

###### 高速缓存存储器（Cache）

CPU可以直接访问，用来存放当前正在执行的程序中的活跃部分（副本），以便快速地像CPU提供指令和数据。

##### 运算器

运算器是对信息进行处理和运算的部件，经常进行的运算时算数运算和逻辑运算，因此计算器的核心时算术逻辑运算部件ALU。

运算其中由若干个寄存器（如累加寄存器，暂存器等）。

##### 控制器

控制器是整个计算机的指挥中心。

控制器中主要包括时序控制信号形成部件和一些专用的寄存器。

#### 各大部件之间的连接

将各大基本部件，按某种方式连接起来就构成了计算机的硬件系统。

##### 总线结构（小、微型机的典型机构）

目前很多计算机的各大基本部件之间使用总线连接起来的。

总线时一组能为多个部件服务的公共信息传送线路，它能分时地发送于接受各部件的信息。

###### 总线特点： 

* 共享
* 分时

小型、微型机的设计目标是以较小的硬件代价组成具有较强功能的系统，而总线结构正好能满足这一要求。

单总线并不是指只有一根信号线。系统总线按传送信息的不同又可以细分为：地址总线，数据总线和控制总线。

###### 地址总线

由单方向的多根信号线组成，用于CPU向主存、外设传输地址信息

###### 数据总线

由双方向的多根信号线组成，CPU可以沿这些线从主存或外设读入数据，也可以沿这些线向主存或外设送出数据；

###### 控制总线

控制总线上传输的是控制信息，包括CPU送出的控制命令和主存/外设反馈给CPU的状态信号。

##### 大、中型计算机的典型机构

大、中型计算机系统的设计目标更着重于系统功能的扩大和效率的提高。

在系统连接上分为四级：主机、通道、设备控制器、外部设备。

通道是承担I/O操作管理的主要部件，主机可以连接多个通道，每个通道可以接一台或几台设备控制器，每个设备控制器由可接一台或几台外部设备，这样整个系统就可以连接很多的外部设备。

##### 冯诺伊曼结构和哈佛结构的存储器设计思想

###### 冯诺伊曼结构

冯诺伊曼结构也称普林斯顿结构，即指令和数据是不加区别地混合存储在同一个存储器中的，共享数据总线。指令地址和数据地址只想同一个存储器的不同物理地址，指令和数据的宽度相同。由于指令和数据存放在同一存储器中，因此冯·诺伊曼结构中不能同时取指令和取操作数。

###### 哈佛结构

哈佛结构的指令和数据是完全分开的，存储器分为两部分，一个是程序存储器，用来存放指令，另一个是数据存储器，用来存放数据。这意味着在一个机器周期内可以同时准备好指令和操作数，本条指令执行时可以预先读取下一条指令，所以哈佛结构的中央处理器通常具有较高的执行效率。

苹果公司改用的arm架构就是使用的哈佛架构设计的，程序指令和数据分开处理。

### 1.3 计算机系统

计算机系统=硬件系统+软件系统

计算机系统是包含计算机硬件系统的，硬件通常是指一切看得见，摸得到的设备实体；软件通常是泛指各类程序和文件，它们实质上是由一些算法以及其在计算机中的表示所构成的。

###### 硬件和软件的关系

硬件是计算机系统的物质基础，软件是计算机系统的灵魂。硬件和软件是相辅相成的，不可分割的整体。

当前计算机的硬件和软件正朝着互相渗透，互相融合的方向发展，在计算机系统中没有一条明确的硬件与软件的分界线。硬件和软件之间的界面是浮动的，对于程序设计人员来说，硬件和软件在逻辑上是等价的。

硬件软化：原来由硬件实现的操作改由软件来实现。它可以增强系统的功能和适应性。

软件硬化：原来由软件实现的操作改由硬件来实现。它可以显著降低软件在时间上的开销。

固件是指那些存储在能永久保存信息的器件中的程序，是具有软件功能的硬件。

固件的性能指标介于硬件于软件之间，吸收了软、硬件各自的有点，其执行速度快于软件，灵活性优于硬件，是软、硬件结合的产物，计算机功能的固件化将成为计算机发展中的一个趋势

###### 系统机和软件兼容

系统机是指一个厂家生产的，具有相同的系统结构，但具有不同组成和实现的一系列不同型号的机器。

系列机应在指令系统、数据格式、字符编码、中断系统、控制方式、输入/输出操作方式等方面保持统一，从而保证软件的兼容性。

软件兼容按照机器档次和推出时间，有四种兼容，分别是机器档次的向上兼容，向下兼容；推出时间的向前兼容，向后兼容。

###### 计算机系统的多层次结构

现代计算机系统是一个硬件与软件组成的综合体，可以把它看成是按功能划分的多层次结构。

硬联逻辑级---微程序集---传统机器级--- 操作系统级---汇编语言级---高级语言级---应用语言级![image-20250329214220951](C:\Users\luomi\Desktop\计组期中复习\JizuQizhongFuxi\计组期中复习.assets\image-20250329214220951.png)

###### 实际机器和虚拟机器

实际机器是指由硬件或固件实现的机器，如上图中的第零级到第二级。虚拟机器是指以软件或以软件为主实现的机器，如上图第三级到第六级。

虚拟机器只对该级的观察者存在，即在某一级的观察者看来，他只需要通过该级的语言来了解和使用计算机，至于下级是如何工作和实现就不必关心了。如高级语言级应用语言级的用户，可以不了解机器的具体组成，不必熟悉指令系统，直接用所指定的语言描述索要解决的问题。简而言之，虚拟计算机是指以软件或一软件为主实现的机器。

### 1.4 计算机的工作过程和主要性能指标

计算机的工作过程是将编制好的程序放在主存中，由控制器控制逐条取出指令执行。

###### 计算机的主要性能指标

1. 机器字长

   机器字长是指参与运算的数的基本位数，它是由加法器、寄存器、数据总线的位数决定的。

   在计算机中为了更灵活地表达和处理信息，许多计算机由以字节(Byte）为基本单位，一个字节等于8位二进制位（bit）

   不同的计算机，字可以不相同，但对于系列机来说，在同一系列中，字确实固定的，如80X86系列中，一个字等于32位。

   这里说的字和字长的概念是由区别的，字实际上是一个度量单位，用于度量各种数据类型的宽度，而字长表示数据运算的宽度，反应了经计算计算机处理信息的能力。它们两者的长度可以一样，也可以不一样。

2. 数据通路宽度
   数据总线一次所能并行传送信息的位数，称为数据通路宽度。它影响到信息的传送能力，从而影响计算机的有效处理速度。这里所说的数据通路宽度是指外部数据总线的宽度，它于CPU内部的数据总线宽度（内部寄存器的大小）有可能不同。

3. 主存容量

   一个主存储器所能存储的全部信息量称为主存容量。衡量主存容量单位有两种：

   1. 字节数。这类计算机称为字节编址的计算机。
   2. 字数×字长。这类计算机称为字编址的计算机。

4. 运算速度

   * 吞吐量和响应时间
     吞吐量是指系统在单位时间内处理请求的数量
     响应时间是指系统对请求做出响应的时间，响应时间包括CPU时间与等待时间的总和。

   * 主频和CPU时钟周期
     CPU的主频又称为时钟频率，表示在CPU内数字脉冲信号震荡的速度。主频的倒数就是CPU时钟周期，这是CPU中最小的时间元素。

   * CPI
     CPI 就是每条指令执行所用的时钟周期数。

   * MIPS和MFLOPS

     MIPS表示每秒百万条指令（一般指加减运算这类短指令）

     MFLOPS表示每秒百万次浮点运算。

## 第二章 数据的机器层次表示

数据是计算机加工和处理的对象，数据的机器层次表示将直接影响到计算机的结构和性能。本章主要介绍无符号数和带符号数的表示方法、数的定点与浮点表示方法、字符和汉字的编码方法、数据校验码等。熟悉和掌握本章的内容，是学习计算机原理的最基本要求。

### 2.1 进位计数制、十进制数和数串的表示

略

二—十进制码（BCD码）：采用4位二进制编码来表示1位十进制数字，在16个编码中选用10个表示数字0~9.

我们往往为其赋权表示比如8421码就是顺序的0~9，超过的都不合法。

余3码：对应的 8421码加上0011构成，是一种自补码，即任何两个相加之和等于9的编码，互为反码。









格雷码：每次数值变动都只有1位数字发生变化![image-20250329221428838](C:\Users\luomi\Desktop\计组期中复习\JizuQizhongFuxi\计组期中复习.assets\image-20250329221428838.png)



### 2.2 数值数据的表示

在计算机中常用后缀字母来表示不同的数制。

* 十进制数（D）
* 二进制数（B）
* 八进制数（Q）
* 十六进制数（H）

C语言中，八进制常数以前缀0开始，十六进制常数以前缀0x开始

#### 无符号数和带符号数

所谓无符号数，就是整个机器字长的全部二进制位均表示数值位（没有符号位），相当于数的绝对值。

对于字长位n+1位的无符号数的表示范围是$0\sim (2^{n+1}-1)$.

原码（略）

由于设备的原因，机器数是由字长限制的，不可能容纳无限大的任意数。当运算结果超出了机器的最大表示范围，就会发生溢出，此时产生的溢出量称为模，用字母M表示。

模实际上是一个计量器的容量，如一个四位的计数器，计数值是0~15，计数器计满15后再加1，这个计数器就发生溢出，其溢出量为16，也就是模等于16。

所以一个字长为n+1位的纯整数的溢出量位2^n+1^，即以2^n+1^位模。

一个纯小数的溢出量为2，即以2为模。

**同余**：两整数A、B除以同一正整数M，所得余数相同，则称A、B对模M同余。
$$
A=B(mod\ M),例：23=13(mod\ 10)
$$

$$
8-2=8+10(mod\ 12)
$$

只要确定了“模”，就可以找到一个与负数等价的正数（改正数即为负数的补数）来代替此负数，而这个正数可以用模加上负数本身求得，这样就可把减法运算用加法实现了。

补码（略）

反码（略）

#### 三种机器数的比较

1. 对于正数它们都等于真值本身，而对于负数各有不同的表示。
2. 最高位都表示符号位，补码和反码的符号位可和数值位一起参加运算；但原码的符号位必须分开进行处理。
3. 对于真值0，原码和反码各有两种不同的表示形式，而补码只有唯一的一种表示形式。
4. 原码、反码表示的正、负数范围是对称的；但补码负数能多表示一个最负的数，其值等于-2^n^（纯整数）或-1（纯小数）。

如果已知机器的字长，则机器数的位数应不够相应的位。

### 2.3 机器数的定点表示与浮点表示

#### 定点表示法

定点表示法规定：所有数据的小数点位置固定不变。通常，把小数点固定在有小数位的最前面或末尾，这就形成了两类定点数。

##### 定点小数

小数点的位置固定在最高有效数位之前，符号位之后，记作X~s~.X~1~X~2~...X~n~，这个数是一个纯小数。定点小数的小数点位置是隐含约定的，小数点并不需要真正地占据一个二进制位。

当机器字长为n+1时，能表示的最大正数为1-2^-n^，最小正数为2^-n^

负数的范围随不同的表示方法而不同，原码表示时所能表达的最大负数为-(1-2^-n^)，补码时所能表达的最大负数为-1。

综上所述，若机器字长有n+1位，则原码定点小数表示范围为：-(1-2^-n^)\~(1-2^-n^)；补码定点小数表示范围为：-1\~(1-2^-n^)

##### 定点整数

小数点位置隐含固定在最低有小数位之后，这个数是一个纯整数。

综上所述，若机器字长有n+1位，则原码定点小数表示范围为：-(2^n^-1)\~(2^n^-1)；补码定点小数表示范围为：-2^n^\~(2^n^-1)

#### 浮点表示法

浮点表示法中，小数点的位置根据需要而浮动，这就是浮点数，例如：
$$
N=M×r^E=M×2^E
$$
上式：r为浮点数阶码的底，与尾数的基数相同，通常r=2。E和M都是带符号数，E叫做阶码，M叫做尾数。在大多数计算机中，尾数为纯小数，常用原码或补码表示，阶码为纯整数，常用移码或补码表示。

![image-20250331013424385](C:\Users\luomi\Desktop\计组期中复习\JizuQizhongFuxi\计组期中复习.assets\image-20250331013424385.png)

浮点数的底是隐含的，整个机器数中，都不出现。阶码的大小反映了浮点数小数点的实际位置；

##### 规格化的浮点数

为了提高运算的精度，需要充分地利用尾数的有效小数位，通常采取规格化的浮点数形式，即规定尾数的最高数位必须是一个有效值。

即尾数采用原码表示时，规格化浮点数的最高数位总等于1。
尾数采用补码表示时，规格化浮点数应满足尾数最高数位与符号位不同（$m_s \oplus m_1=1$）。

需要注意的是，对于原码表示来说，是规格数，不一定对补码表示来说是规格数；
如$M=-\frac{1}{2}$时，对于原码表示时，是规格数，对于补码表示来说，不是规格数（只有两位机器字长时表示为11）；
当$M=-1$时，对于原码表示时，无法表示，对于补码表示来说，是规格数。

移码（略）所有的数加上一个偏置数，都移到数轴的正值。

浮点数的阶码采用表示最主要的原因时：

1. 便于比较浮点数的大小。阶码大的，其对应的真值就大，阶码小的，对应的真值就小。
2. 简化机器中的判零电路，当阶码全为0，尾数也全为0时，表示机器零。

##### IEEE754标准浮点数

大多数计算机的浮点数采用**IEEE 754**标准，其格式如下，**IEEE 754**标准中有三种形式的浮点数![image-20250331015451278](C:\Users\luomi\Desktop\计组期中复习\JizuQizhongFuxi\计组期中复习.assets\image-20250331015451278.png)

为了使尾数部分能多表示一位的有效值，**IEEE 754**采用隐含尾数最高位1（即这一位1不表示出来）的方法。
应注意的是，隐含的1是一位整数（即位权为2^0^），在浮点格式中表示出来的23位尾数是纯小数，并用原码表示。

#### 定点/浮点表示法与定点/浮点计算机

##### 定点/浮点表示法的区别

假设定点数和浮点数的字长相同

1. 数值的表示范围
   浮点表示法所能表示的数值范围将远远大于定点数

   应当注意的有两点：

   * 不管定点数还是浮点数，每个数值都对应数轴上的一个点，所谓数的表示范围，实际上指的只是数的上、下限，它们之间只是一些不连续的殿，而不是一段连续的区间。
   * 对于定点数而言，各个点在数轴上的分布是均匀的；而对于浮点数而言，各个点在数轴上的分布是不均匀的，越靠近数轴的原点，两个相邻数之间的距离就越近。

2. 精度
   浮点数虽然扩大了数的表示范围，但这是以降低精度为代价的，数轴上个点的排列更稀疏了[能落到数轴上的点的总数是一样的]

3. 数的运算
   浮点运算要比定点运算复杂得多

4. 溢出处理
   在定点运算时，当运算结果超出数的表示范围，就发生溢出。而在浮点运算时，运算结果超出尾码的表示范围却不一定溢出，只有当阶码超出所能表示的范围时，才发生溢出。

##### 定点机与浮点机

并不是所有计算机都具有浮点运算的功能，通常可以分为下面三档：

1. 定点机
   以定点运算为主，浮点运算是通过软件来实现的

2. 定点机+浮点运算部件
   浮点运算部件（FPU）是专门用于对浮点数进行运算的部件。

3. 浮点机

   具有浮点运算指令和基本的浮点运算器

### 2.4 非数值数据的表示

#### 字符和字符串的表示方法

##### ASCII字符编码

常见的ASCII码用七位二进制表示一个字符，它包括10个十进制数字、52个英文大写和小写字母、34个专用符号和32个控制符号，共计128个字符。

##### 字符串的表示

###### 向量法

在存储器中占用一片连续的空间，对每个字节存放一个字符代码，字符串的所有元素（字符）在物理上是邻接的。

###### 串表法

存储单元中不全存放字符代码，在字符代码后有一个链接字，指出下一个字符的存储单元地址。串表法不要求串中的各个字符在物理上相邻，在对字符串进行删除和插入时，只需修改相应字符代码后面的链接字即可。
但是由于链接字占据了存储单元的空间，使得主存的有效利用率下降。

##### 汉字的表示

###### 汉字国标码

**GB2312-80**，简称国标码，共收集常用汉字6763个，其中一级汉字3755个，按拼音排序；二级汉字3008个，按部首排序；另外还有各种图形符号682个，共计7445个。

每个汉字、图形符号都用两个字节表示，每个字节只使用低七位编码。

###### 汉字区位码

区位码将汉字国标码中的6763个汉字分为94个区，每个区中包含94个汉字（位），区和位组成一个二维数组，每个汉字在组中获得一个唯一的区位码。汉字的区位码字长位4位，前2位表示区号，后两位表示位号，区号和位号用十进制数表示，区号从01到94，位号也从01到94.

国标码=区位码（十六进制）+2020H

###### 汉字机内码

汉字可以通过不同的输入码输入，但在计算机内部其内码时唯一的。因为汉字处理系统要保证中西文的兼容。防止ASCII码和汉字国标码产生二义性。

常用的汉字机内码为两字节长的代码，他是在相应汉字国标码的每个字节最高位上+1。

汉字机内码=汉字国标码+8080H

###### 汉字字形码

汉字字形码是指确定一个汉字字形点阵的代码，又叫汉字字模码或汉字输出码。在一个汉字点阵中，笔画所到之处，记为“1”，否则记为“0”。

根据对汉字质量的不同要求，点阵结构大小不同，占用的字节数也不同。

### 2.5 数据校验码

用于检查或纠正在存取、读写和传送数据的过程中可能出现的错误的方法

冗余校验：通过在有效信息代码的基础上，添加一些冗余位来构成整个校验码。

校验码的构成：有效信息+校验位

* 只有当合法码间的码距大于二时，校验码才具有检错能力。码距大于3时，校验码才具有纠错能力。
* 如果码距d为奇数，只用来检查错误，可以发现d-1位错误，用来纠正错误，可以发现$\frac{d-1}{2}$位错误。
* 若码距d为偶数，则可以发现$\frac{d}{2}$位错误，并可以纠正$\frac{d}{2}-1$位错误。

###### 奇偶校验码

在有效信息位的前面或后面添加一位奇（偶）校验位就组成了奇偶校验码，

* 奇校验码：奇校验位取值使得整个奇校验码中”1“的个数为奇数
* 偶校验吗：偶校验位取值使得整个偶校验码中”1“的个数为偶数

接收端检验接收到的校验码信息的奇偶性，判断校验码是否合法。

###### 海明校验码

通过插入多个校验位，对数据中每一二进制位进行校验。

例如一个4位二进制码0111，通过海明校验码的方法，进行校验，就需要插入4-1=3位校验位，分别插入到倒数第2^0^位、倒数第2^1^位、倒数第2^2^位

| 7    | 6    | 5    | 4      | 3    | 2      | 1      |
| ---- | ---- | ---- | ------ | ---- | ------ | ------ |
| 0    | 1    | 1    | 校验位 | 1    | 校验位 | 校验位 |

第七位由4，2，1共同校验（7=4+2+1）
第六位由4，2共同校验。
...

$r_4=r_7\oplus r_6\oplus r_5$，$r_2=r_7\oplus r_6\oplus r_3$，$r_1=r_7\oplus r_5\oplus r_3$
所以校验码位011\[0]1\[0]\[0]

###### CRC校验码

循环冗余校验码（CRC）可以检出多位错误。

通过约定一个除数，在原先传输数据后附加上其通过模2除法得到的余数，在传输后检查收到数据是否能被整除，判断数据是否正确。
